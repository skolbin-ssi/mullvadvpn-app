<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="3896px" preserveAspectRatio="none" style="width:6900px;height:3896px;background:#FFFFFF;" version="1.1" viewBox="0 0 6900 3896" width="6900px" zoomAndPan="magnify"><defs/><g><rect height="3825.3516" style="stroke:#000000;stroke-width:4.0;fill:none;" width="6830.6667" x="48" y="48"/><rect height="40" style="stroke:#000000;stroke-width:4.0;fill:none;" width="60" x="6798.6667" y="68"/><rect height="8" style="stroke:#000000;stroke-width:4.0;fill:none;" width="16" x="6790.6667" y="76"/><rect height="8" style="stroke:#000000;stroke-width:4.0;fill:none;" width="16" x="6790.6667" y="92"/><text fill="#000000" font-family="sans-serif" font-size="56" font-weight="bold" lengthAdjust="spacing" textLength="464" x="3231.3333" y="159.8555">Mullvad daemon</text><polygon points="2165.6667,550.8145,2205.6667,510.8145,3839.6667,510.8145,3839.6667,1439.5996,3799.6667,1479.5996,2165.6667,1479.5996,2165.6667,550.8145" style="stroke:#000000;stroke-width:4.0;fill:none;"/><line style="stroke:#000000;stroke-width:4.0;fill:none;" x1="3799.6667" x2="3839.6667" y1="550.8145" y2="510.8145"/><line style="stroke:#000000;stroke-width:4.0;fill:none;" x1="2165.6667" x2="3799.6667" y1="550.8145" y2="550.8145"/><line style="stroke:#000000;stroke-width:4.0;fill:none;" x1="3799.6667" x2="3799.6667" y1="550.8145" y2="1479.5996"/><text fill="#000000" font-family="sans-serif" font-size="56" font-weight="bold" lengthAdjust="spacing" textLength="232" x="2870.6667" y="622.6699">Daemon</text><polygon points="5678.6667,2884.5664,5718.6667,2844.5664,6818.6667,2844.5664,6818.6667,3773.3516,6778.6667,3813.3516,5678.6667,3813.3516,5678.6667,2884.5664" style="stroke:#000000;stroke-width:4.0;fill:none;"/><line style="stroke:#000000;stroke-width:4.0;fill:none;" x1="6778.6667" x2="6818.6667" y1="2884.5664" y2="2844.5664"/><line style="stroke:#000000;stroke-width:4.0;fill:none;" x1="5678.6667" x2="6778.6667" y1="2884.5664" y2="2884.5664"/><line style="stroke:#000000;stroke-width:4.0;fill:none;" x1="6778.6667" x2="6778.6667" y1="2884.5664" y2="3813.3516"/><text fill="#000000" font-family="sans-serif" font-size="56" font-weight="bold" lengthAdjust="spacing" textLength="596" x="5934.6667" y="2956.4219">Tunnel state machine</text><!--MD5=[1afb120ece2a2e075c13cfff69101ff5]
entity management_interface--><g id="elem_management_interface"><ellipse cx="3002.6667" cy="244" fill="#F1F1F1" rx="32" ry="32" style="stroke:#181818;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="612" x="2696.6667" y="371.8555">Management interface</text></g><!--MD5=[c80e09b31bbe947e896e97e9816d3ac4]
entity mullvad_api--><g id="elem_mullvad_api"><ellipse cx="3454.6667" cy="2880.5664" fill="#F1F1F1" rx="32" ry="32" style="stroke:#181818;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="316" x="3296.6667" y="3008.4219">Mullvad API</text></g><!--MD5=[214964582c7f12160347bada66fc7a64]
entity account_manager--><g id="elem_account_manager"><rect fill="#F1F1F1" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="580" x="1798.6667" y="1830.4141"/><rect fill="#F1F1F1" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="2298.6667" y="1850.4141"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="2290.6667" y="1858.4141"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="2290.6667" y="1874.4141"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="420" x="1858.6667" y="1970.2695">Account service</text></g><!--MD5=[4dc02cab549e7de5b25fb9c57cd065cc]
entity rest_service--><g id="elem_rest_service"><rect fill="#F1F1F1" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="640" x="3134.6667" y="2337.4902"/><rect fill="#F1F1F1" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="3694.6667" y="2357.4902"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="3686.6667" y="2365.4902"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="3686.6667" y="2381.4902"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="480" x="3194.6667" y="2477.3457">Mullvad API client</text></g><!--MD5=[0946963daeb075011ae058ee50c19d8d]
entity relay_list_updater--><g id="elem_relay_list_updater"><rect fill="#F1F1F1" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="632" x="1084" y="1830.4141"/><rect fill="#F1F1F1" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="1636" y="1850.4141"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="1628" y="1858.4141"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="1628" y="1874.4141"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="472" x="1144" y="1970.2695">Relay list updater</text></g><!--MD5=[83995bdcb5bdc20efee1eea8bb7a1d17]
entity version_updater--><g id="elem_version_updater"><rect fill="#F1F1F1" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="592" x="3350.6667" y="1830.4141"/><rect fill="#F1F1F1" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="3862.6667" y="1850.4141"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="3854.6667" y="1858.4141"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="3854.6667" y="1874.4141"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="432" x="3410.6667" y="1970.2695">Version updater</text></g><!--MD5=[f3215de272db620b14c75a31918918a6]
entity relay_selector--><g id="elem_relay_selector"><rect fill="#FFFF00" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="532" x="2215.6667" y="2844.5664"/><rect fill="#FFFF00" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="2667.6667" y="2864.5664"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="2659.6667" y="2872.5664"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="2659.6667" y="2888.5664"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="372" x="2275.6667" y="2984.4219">Relay selector</text></g><!--MD5=[44df82fb778fec0901a72cffa7010adb]
entity settings--><g id="elem_settings"><rect fill="#FFFF00" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="376" x="2388.3333" y="670.8145"/><rect fill="#FFFF00" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="2684.3333" y="690.8145"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="2676.3333" y="698.8145"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="2676.3333" y="714.8145"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="216" x="2448.3333" y="810.6699">Settings</text></g><!--MD5=[8bcc0b63da7c8ed453f57736117f3f6c]
entity account_history--><g id="elem_account_history"><rect fill="#FFFF00" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="576" x="2225.6667" y="947.0762"/><rect fill="#FFFF00" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="2721.6667" y="967.0762"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="2713.6667" y="975.0762"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="2713.6667" y="991.0762"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="416" x="2285.6667" y="1086.9316">Account history</text></g><!--MD5=[e4edd212dd31643a78974f3f84aba42d]
entity inactivity_timer--><g id="elem_inactivity_timer"><rect fill="#FFFF00" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="560" x="2881.6667" y="947.0762"/><rect fill="#FFFF00" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="3361.6667" y="967.0762"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="3353.6667" y="975.0762"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="3353.6667" y="991.0762"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="400" x="2941.6667" y="1086.9316">Inactivity timer</text></g><!--MD5=[ebf5de7ac07bb0987ea04cb1d2b762ba]
entity Various state around tunnels and relays--><g id="elem_Various state around tunnels and relays"><rect fill="#FFFF00" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="1236" x="2543.6667" y="1223.3379"/><rect fill="#FFFF00" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="3699.6667" y="1243.3379"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="3691.6667" y="1251.3379"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="3691.6667" y="1267.3379"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="1076" x="2603.6667" y="1363.1934">Various state around tunnels and relays</text></g><!--MD5=[774f8f385b32f4d4477c8c157bcfd52b]
entity firewall--><g id="elem_firewall"><rect fill="#FFFF00" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="368" x="5800" y="3004.5664"/><rect fill="#FFFF00" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="6088" y="3024.5664"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="6080" y="3032.5664"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="6080" y="3048.5664"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="208" x="5860" y="3144.4219">Firewall</text></g><!--MD5=[30e382dc68ab04d49d3ef5ad3266e605]
entity dns--><g id="elem_dns"><rect fill="#FFFF00" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="276" x="5784.6667" y="3280.8281"/><rect fill="#FFFF00" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="5980.6667" y="3300.8281"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="5972.6667" y="3308.8281"/><rect fill="#FFFF00" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="5972.6667" y="3324.8281"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="116" x="5844.6667" y="3420.6836">DNS</text></g><!--MD5=[54409d5519d7646972cabb5538a3d297]
entity routing--><g id="elem_routing"><rect fill="#F1F1F1" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="368" x="5738.6667" y="3557.0898"/><rect fill="#F1F1F1" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="6026.6667" y="3577.0898"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="6018.6667" y="3585.0898"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="6018.6667" y="3601.0898"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="208" x="5798.6667" y="3696.9453">Routing</text></g><!--MD5=[8c21351e3c267459e66364a53ec93dcf]
entity tunnel--><g id="elem_tunnel"><rect fill="#F1F1F1" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="348" x="6298.6667" y="3280.8281"/><rect fill="#F1F1F1" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="6566.6667" y="3300.8281"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="6558.6667" y="3308.8281"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="6558.6667" y="3324.8281"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="188" x="6358.6667" y="3420.6836">Tunnel</text></g><!--MD5=[058bc522d86866626cb47ee4041f5557]
entity offline_monitor--><g id="elem_offline_monitor"><rect fill="#F1F1F1" height="196.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="572" x="6186.6667" y="3557.0898"/><rect fill="#F1F1F1" height="40" style="stroke:#181818;stroke-width:2.0;" width="60" x="6678.6667" y="3577.0898"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="6670.6667" y="3585.0898"/><rect fill="#F1F1F1" height="8" style="stroke:#181818;stroke-width:2.0;" width="16" x="6670.6667" y="3601.0898"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="412" x="6246.6667" y="3696.9453">Offline monitor</text></g><line style="stroke:#181818;stroke-width:4.0;" x1="3002.6667" x2="3002.6667" y1="280" y2="510.8145"/><polygon fill="#181818" points="3002.6667,510.8145,3018.6667,474.8145,3002.6667,490.8145,2986.6667,474.8145,3002.6667,510.8145" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="356" x="2638.6667" y="415.5801">Incoming RPCs</text><line style="stroke:#181818;stroke-width:4.0;" x1="3337.4667" x2="3337.4667" y1="1479.5996" y2="1599.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="3337.4667" x2="4254.6667" y1="1599.5996" y2="1599.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="4254.6667" x2="4254.6667" y1="1599.5996" y2="2764.5664"/><line style="stroke:#181818;stroke-width:4.0;" x1="4254.6667" x2="6134.6667" y1="2764.5664" y2="2764.5664"/><line style="stroke:#181818;stroke-width:4.0;" x1="6134.6667" x2="6134.6667" y1="2764.5664" y2="2844.5664"/><polygon fill="#181818" points="6134.6667,2844.5664,6150.6667,2808.5664,6134.6667,2824.5664,6118.6667,2808.5664,6134.6667,2844.5664" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="556" x="3690.6667" y="2162.2559">Sets target tunnel state</text><line style="stroke:#181818;stroke-width:4.0;" x1="6362.6667" x2="6362.6667" y1="2844.5664" y2="2724.5664"/><line style="stroke:#181818;stroke-width:4.0;" x1="6362.6667" x2="5850.6667" y1="2724.5664" y2="2724.5664"/><line style="stroke:#181818;stroke-width:4.0;" x1="5850.6667" x2="5850.6667" y1="2724.5664" y2="1559.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="5850.6667" x2="3504.8667" y1="1559.5996" y2="1559.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="3504.8667" x2="3504.8667" y1="1559.5996" y2="1479.5996"/><polygon fill="#181818" points="3504.8667,1479.5996,3520.8667,1443.5996,3504.8667,1459.5996,3488.8667,1443.5996,3504.8667,1479.5996" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="1544" x="4298.6667" y="2162.2559">Notifies of changes to tunnel state, gets tunnel connection config</text><line style="stroke:#181818;stroke-width:4.0;" x1="6590.6667" x2="6590.6667" y1="2844.5664" y2="1519.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="6590.6667" x2="3672.2667" y1="1519.5996" y2="1519.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="3672.2667" x2="3672.2667" y1="1519.5996" y2="1479.5996"/><polygon fill="#181818" points="3672.2667,1479.5996,3688.2667,1443.5996,3672.2667,1459.5996,3656.2667,1443.5996,3672.2667,1479.5996" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="688" x="5894.6667" y="2162.2559">Get tunnel connection config</text><line style="stroke:#181818;stroke-width:4.0;" x1="2333.0667" x2="2333.0667" y1="1479.5996" y2="1519.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="2333.0667" x2="824" y1="1519.5996" y2="1519.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="824" x2="824" y1="1519.5996" y2="2764.5664"/><line style="stroke:#181818;stroke-width:4.0;" x1="824" x2="2348.6667" y1="2764.5664" y2="2764.5664"/><line style="stroke:#181818;stroke-width:4.0;" x1="2348.6667" x2="2348.6667" y1="2764.5664" y2="2844.5664"/><polygon fill="#181818" points="2348.6667,2844.5664,2364.6667,2808.5664,2348.6667,2824.5664,2332.6667,2808.5664,2348.6667,2844.5664" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="708" x="108" y="2162.2559">Select a relay for a connection</text><line style="stroke:#181818;stroke-width:4.0;" x1="3002.6667" x2="3002.6667" y1="1479.5996" y2="2217.4902"/><line style="stroke:#181818;stroke-width:4.0;" x1="3002.6667" x2="3518.6667" y1="2217.4902" y2="2217.4902"/><line style="stroke:#181818;stroke-width:4.0;" x1="3518.6667" x2="3518.6667" y1="2217.4902" y2="2337.4902"/><polygon fill="#181818" points="3518.6667,2337.4902,3534.6667,2301.4902,3518.6667,2317.4902,3502.6667,2301.4902,3518.6667,2337.4902" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="536" x="2458.6667" y="1948.7178">Change API availability</text><line style="stroke:#181818;stroke-width:4.0;" x1="2500.4667" x2="2500.4667" y1="1479.5996" y2="1559.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="2500.4667" x2="1400" y1="1559.5996" y2="1559.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="1400" x2="1400" y1="1559.5996" y2="1830.4141"/><polygon fill="#181818" points="1400,1830.4141,1416,1794.4141,1400,1810.4141,1384,1794.4141,1400,1830.4141" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="524" x="868" y="1735.1797">Force relay list update</text><line style="stroke:#181818;stroke-width:4.0;" x1="3170.0667" x2="3170.0667" y1="1479.5996" y2="1639.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="3170.0667" x2="3646.6667" y1="1639.5996" y2="1639.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="3646.6667" x2="3646.6667" y1="1639.5996" y2="1830.4141"/><polygon fill="#181818" points="3646.6667,1830.4141,3662.6667,1794.4141,3646.6667,1810.4141,3630.6667,1794.4141,3646.6667,1830.4141" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="508" x="3130.6667" y="1735.1797">Fetch current version</text><line style="stroke:#181818;stroke-width:4.0;" x1="2835.2667" x2="2835.2667" y1="1479.5996" y2="1639.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="2835.2667" x2="2185.3333" y1="1639.5996" y2="1639.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="2185.3333" x2="2185.3333" y1="1639.5996" y2="1830.4141"/><polygon fill="#181818" points="2185.3333,1830.4141,2201.3333,1794.4141,2185.3333,1810.4141,2169.3333,1794.4141,2185.3333,1830.4141" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="456" x="2197.3333" y="1735.1797">Fetch account data</text><line style="stroke:#181818;stroke-width:4.0;" x1="1294.6667" x2="1294.6667" y1="2026.6758" y2="2066.6758"/><line style="stroke:#181818;stroke-width:4.0;" x1="1294.6667" x2="893.3333" y1="2066.6758" y2="2066.6758"/><line style="stroke:#181818;stroke-width:4.0;" x1="893.3333" x2="893.3333" y1="2066.6758" y2="2724.5664"/><line style="stroke:#181818;stroke-width:4.0;" x1="893.3333" x2="2481.6667" y1="2724.5664" y2="2724.5664"/><line style="stroke:#181818;stroke-width:4.0;" x1="2481.6667" x2="2481.6667" y1="2724.5664" y2="2844.5664"/><polygon fill="#181818" points="2481.6667,2844.5664,2497.6667,2808.5664,2481.6667,2824.5664,2465.6667,2808.5664,2481.6667,2844.5664" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="384" x="905.3333" y="2455.7939">Update relay list</text><line style="stroke:#181818;stroke-width:4.0;" x1="1992" x2="1992" y1="1830.4141" y2="1599.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="1992" x2="2667.8667" y1="1599.5996" y2="1599.5996"/><line style="stroke:#181818;stroke-width:4.0;" x1="2667.8667" x2="2667.8667" y1="1599.5996" y2="1479.5996"/><polygon fill="#181818" points="2667.8667,1479.5996,2683.8667,1443.5996,2667.8667,1459.5996,2651.8667,1443.5996,2667.8667,1479.5996" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="540" x="1444" y="1735.1797">Account/device events</text><line style="stroke:#181818;stroke-width:4.0;" x1="3294.6667" x2="3294.6667" y1="2533.752" y2="2573.752"/><line style="stroke:#181818;stroke-width:4.0;" x1="3294.6667" x2="2614.6667" y1="2573.752" y2="2573.752"/><line style="stroke:#181818;stroke-width:4.0;" x1="2614.6667" x2="2614.6667" y1="2573.752" y2="2844.5664"/><polygon fill="#181818" points="2614.6667,2844.5664,2630.6667,2808.5664,2614.6667,2824.5664,2598.6667,2808.5664,2614.6667,2844.5664" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="884" x="1722.6667" y="2669.332">Select bridge relay for API connection</text><line style="stroke:#181818;stroke-width:4.0;" x1="3614.6667" x2="3614.6667" y1="2533.752" y2="2573.752"/><line style="stroke:#181818;stroke-width:4.0;" x1="3614.6667" x2="4210.6667" y1="2573.752" y2="2573.752"/><line style="stroke:#181818;stroke-width:4.0;" x1="4210.6667" x2="4210.6667" y1="2573.752" y2="2804.5664"/><line style="stroke:#181818;stroke-width:4.0;" x1="4210.6667" x2="5906.6667" y1="2804.5664" y2="2804.5664"/><line style="stroke:#181818;stroke-width:4.0;" x1="5906.6667" x2="5906.6667" y1="2804.5664" y2="2844.5664"/><polygon fill="#181818" points="5906.6667,2844.5664,5922.6667,2808.5664,5906.6667,2824.5664,5890.6667,2808.5664,5906.6667,2844.5664" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="520" x="3682.6667" y="2669.332">Unblock API endpoint</text><line style="stroke:#181818;stroke-width:4.0;" x1="3454.6667" x2="3454.6667" y1="2533.752" y2="2844.5664"/><polygon fill="#181818" points="3454.6667,2844.5664,3470.6667,2808.5664,3454.6667,2824.5664,3438.6667,2808.5664,3454.6667,2844.5664" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="788" x="2658.6667" y="2669.332">Send requests to our web service</text><line style="stroke:#181818;stroke-width:4.0;" x1="1505.3333" x2="1505.3333" y1="2026.6758" y2="2297.4902"/><line style="stroke:#181818;stroke-width:4.0;" x1="1505.3333" x2="3262.6667" y1="2297.4902" y2="2297.4902"/><line style="stroke:#181818;stroke-width:4.0;" x1="3262.6667" x2="3262.6667" y1="2297.4902" y2="2337.4902"/><polygon fill="#181818" points="3262.6667,2337.4902,3278.6667,2301.4902,3262.6667,2317.4902,3246.6667,2301.4902,3262.6667,2337.4902" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="560" x="937.3333" y="2162.2559">Fetch relay list from API</text><line style="stroke:#181818;stroke-width:4.0;" x1="3646.6667" x2="3646.6667" y1="2026.6758" y2="2337.4902"/><polygon fill="#181818" points="3646.6667,2337.4902,3662.6667,2301.4902,3646.6667,2317.4902,3630.6667,2301.4902,3646.6667,2337.4902" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="592" x="3046.6667" y="2162.2559">Fetch latest app versions</text><line style="stroke:#181818;stroke-width:4.0;" x1="2088.6667" x2="2088.6667" y1="2026.6758" y2="2257.4902"/><line style="stroke:#181818;stroke-width:4.0;" x1="2088.6667" x2="3390.6667" y1="2257.4902" y2="2257.4902"/><line style="stroke:#181818;stroke-width:4.0;" x1="3390.6667" x2="3390.6667" y1="2257.4902" y2="2337.4902"/><polygon fill="#181818" points="3390.6667,2337.4902,3406.6667,2301.4902,3390.6667,2317.4902,3374.6667,2301.4902,3390.6667,2337.4902" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="456" x="1624.6667" y="2162.2559">Fetch account data</text><!--MD5=[a228e29a7310b824925713fb8c988b90]
@startuml
hide empty description
scale 10000

left to right direction
!pragma layout elk


component "Mullvad daemon" as mullvad_daemon {
  () "Management interface" as management_interface
  () "Mullvad API" as mullvad_api

  node "Daemon" as daemon {
    [Settings] as settings #yellow
    [Account history] as account_history #yellow
    [Inactivity timer] as inactivity_timer #yellow
    [Various state around tunnels and relays] #yellow
  }

  node "Tunnel state machine" as tsm {
    [Firewall] as firewall #yellow
    [DNS] as dns #yellow
    [Routing] as routing
    [Tunnel] as tunnel
    [Offline monitor] as offline_monitor
  }

  [Account service] as account_manager
  [Mullvad API client] as rest_service
  [Relay list updater] as relay_list_updater
  [Version updater] as version_updater
  [Relay selector] as relay_selector #yellow
}


management_interface -> daemon : Incoming RPCs

daemon -> tsm : Sets target tunnel state
tsm -> daemon : "Notifies of changes to tunnel state, gets tunnel connection config"
tsm -> daemon : Get tunnel connection config
daemon -> relay_selector : Select a relay for a connection
daemon -> rest_service : Change API availability
daemon -> relay_list_updater : Force relay list update
daemon -> version_updater : Fetch current version
daemon -> account_manager : Fetch account data

relay_list_updater -> relay_selector : Update relay list
account_manager -> daemon : Account/device events


rest_service -> relay_selector : Select bridge relay for API connection
rest_service -> tsm : Unblock API endpoint
rest_service -> mullvad_api : Send requests to our web service

relay_list_updater -> rest_service : Fetch relay list from API
version_updater -> rest_service : Fetch latest app versions
account_manager -> rest_service : Fetch account data


@enduml

PlantUML version 1.2022.3(Tue Mar 29 17:10:57 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>